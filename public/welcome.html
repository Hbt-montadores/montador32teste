<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bem-vindo! - Montador de Sermões 3.2</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="/manifest.json">
    
    <script src="pwa-installer.js" defer></script>
</head>
<body>
    <header>
        <img src="https://cdn.glitch.global/db74bd9b-d683-421c-9223-f55b917c9dce/logo.png?v=1734385573934" alt="Logo do Montador de Sermões 3.2" class="logo">
    </header>
    
    <div class="welcome-container">
        <h1 id="welcome-title">Parabéns!</h1>
        <p id="welcome-text">Seja bem-vindo ao Montador de Sermões 3.2. Para a melhor experiência, recomendamos instalar o atalho do aplicativo em seu dispositivo.</p>
        
        <button id="action-button" class="start-button">Começar a Usar</button>
    </div>

    <!-- PAINEL DE DEPURAÇÃO -->
    <div style="max-width: 600px; margin: 20px auto; padding: 15px; border: 2px solid #ccc; background-color: #f9f9f9; text-align: left;">
        <h3 style="margin-top: 0;">Painel de Status da Instalação</h3>
        <ul style="list-style-type: none; padding: 0;">
            <li style="margin-bottom: 8px;">1. Ouvinte Carregado? (`pwa-installer.js`): <strong id="debug-listener-status" style="color: gray;">Aguardando...</strong></li>
            <li style="margin-bottom: 8px;">2. Evento Disparado? (`beforeinstallprompt`): <strong id="debug-event-status" style="color: orange;">Não</strong></li>
            <li style="margin-bottom: 8px;">3. Prompt Capturado? (`window.deferredPrompt`): <strong id="debug-capture-status" style="color: orange;">Não</strong></li>
            <li style="margin-bottom: 8px;">4. Permissão de Notificação?: <strong id="debug-notification-status" style="color: gray;">Verificando...</strong></li>
        </ul>
        <small>Este painel é apenas para depuração e será removido posteriormente.</small>
    </div>
    <!-- FIM DO PAINEL DE DEPURAÇÃO -->

    <script>
        // Lógica da página com inicialização do painel de depuração

        const actionButton = document.getElementById('action-button');

        // --- LÓGICA DE DEPURAÇÃO ---
        function updateNotificationDebugStatus() {
            const statusEl = document.getElementById('debug-notification-status');
            const permission = Notification.permission;
            statusEl.textContent = permission;
            if (permission === 'granted') {
                statusEl.style.color = 'green';
            } else if (permission === 'denied') {
                statusEl.style.color = 'orange';
            } else {
                statusEl.style.color = 'gray';
            }
        }
        
        // --- LÓGICA FUNCIONAL (simplificada para o teste) ---

        function redirectToApp() {
            window.location.href = '/app';
        }

        actionButton.addEventListener('click', async () => {
            // No clique, a única coisa que importa é se o prompt FOI capturado
            if (window.deferredPrompt) {
                console.log('[Welcome-Debug] Botão clicado, prompt existe. Mostrando...');
                window.deferredPrompt.prompt();
                const { outcome } = await window.deferredPrompt.userChoice;
                console.log(`[Welcome-Debug] Resultado da instalação: ${outcome}`);
                
                // Se aceito, limpamos para não oferecer de novo
                if (outcome === 'accepted') {
                    window.deferredPrompt = null;
                }
                
                // Após a interação, redirecionamos
                setTimeout(redirectToApp, 500);

            } else {
                console.log('[Welcome-Debug] Botão clicado, mas nenhum prompt para mostrar. Redirecionando...');
                alert('Nenhuma opção de instalação foi oferecida pelo navegador neste momento. Você será redirecionado para o app.');
                redirectToApp();
            }
        });
        
        // --- INICIALIZAÇÃO DA PÁGINA ---
        window.addEventListener('load', () => {
            // Inicializa o status da notificação no painel de debug
            updateNotificationDebugStatus();

            // Verifica a cada segundo se o prompt de instalação foi capturado
            // Isso ajuda a visualizar qualquer delay do navegador.
            setInterval(() => {
                if(window.deferredPrompt && actionButton.innerText !== 'Instalar App') {
                    actionButton.innerText = 'Instalar App';
                }
            }, 1000);
        });
    </script>
</body>
</html>
